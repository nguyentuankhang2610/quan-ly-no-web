<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Nợ</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #f4f7f6; color: #333; }
        .container { max-width: 900px; margin: 20px auto; padding: 20px; background-color: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1, h2 { color: #2c3e50; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        form { background-color: #ecf0f1; padding: 20px; border-radius: 5px; margin-bottom: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-group { display: flex; flex-direction: column; }
        label { margin-bottom: 5px; font-weight: bold; }
        input, select, button { padding: 10px; border: 1px solid #bdc3c7; border-radius: 4px; font-size: 16px; }
        button { background-color: #3498db; color: white; border: none; cursor: pointer; grid-column: span 2; }
        button:hover { background-color: #2980b9; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #34495e; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        .total-row { font-weight: bold; background-color: #e8f6f3; }
        .amount-debt { color: #e74c3c; font-weight: bold; }
        .amount-paid { color: #2ecc71; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Bảng Điều Khiển Quản Lý Nợ</h1>

        <!-- Form để thêm giao dịch mới -->
        <form action="/add" method="POST">
            <h2>Thêm Giao Dịch Mới</h2>
            <div class="form-group">
                <label for="name">Tên Người Giao Dịch</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="amount">Số Tiền</label>
                <input type="number" id="amount" name="amount" min="0.01" step="0.01" required>
            </div>
            <div class="form-group" style="grid-column: span 2;">
                <label for="description">Nội dung</label>
                <input type="text" id="description" name="description" required>
            </div>
            <div class="form-group">
                <label for="type">Loại Giao Dịch</label>
                <select id="type" name="type">
                    <option value="debt">Ghi Nợ (Cho vay/Mua chịu)</option>
                    <option value="pay">Trả Nợ (Được trả)</option>
                </select>
            </div>
            <button type="submit">Thêm Giao Dịch</button>
        </form>

        <!-- Bảng tổng kết theo người -->
        <h2>Tổng Kết Theo Người</h2>
        <table>
            <thead>
                <tr>
                    <th>Tên</th>
                    <th>Tổng Nợ Còn Lại</th>
                </tr>
            </thead>
            <tbody>
                {% for name, total in summary.items() %}
                <tr>
                    <td>{{ name }}</td>
                    <td class="amount-debt">{{ "%.2f"|format(total) }}</td>
                </tr>
                {% endfor %}
                <tr class="total-row">
                    <td>TỔNG CỘNG</td>
                    <td>{{ "%.2f"|format(total_debt) }}</td>
                </tr>
            </tbody>
        </table>

        <!-- Bảng lịch sử tất cả giao dịch -->
        <h2>Lịch Sử Giao Dịch (Mới nhất lên đầu)</h2>
        <table>
            <thead>
                <tr>
                    <th>Tên</th>
                    <th>Thời Gian</th>
                    <th>Nội Dung</th>
                    <th>Ghi Nợ</th>
                    <th>Trả Nợ</th>
                </tr>
            </thead>
            <tbody>
                {% for trans in transactions %}
                <tr>
                    <td>{{ trans.name }}</td>
                    <td>{{ trans.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td>{{ trans.description }}</td>

                    {% if trans.amount > 0 %}
                        <td class="amount-debt">{{ "%.2f"|format(trans.amount) }}</td>
                        <td></td>
                    {% else %}
                        <td></td>
                        <td class="amount-paid">{{ "%.2f"|format(trans.amount|abs) }}</td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>